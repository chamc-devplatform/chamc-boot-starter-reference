# SDK接口

## 说明

SDK接口能够让开发人员快速的开发应用，进行灵活的流程应用的支持。在SDK中封装了工作流引擎提供的各种服务，为开发人员提供便利。

## 接入方式

    chamc.bpm.type=chamc
    chamc.bpm.chamc.tenant-id=xxx   #租户code
    chamc.bpm.chamc.log-level=xxx   #日志级别，basic full headers none

    #添加token配置项
    chamc.service.token=xxx #会先找该token，没有的话找chamc.service.bpm.token=

## 获取接口的方式

目前SDK主要提供3类的接口，包路径为`com.chamc.boot.bpm.service`，接口分类列表如下：

<table>
   <tr>
      <td>编号</td>
      <td>interface</td>
      <td>描述</td>
   </tr>
   <tr>
      <td>1</td>
      <td>IInstanceService</td>
      <td>流程实例相关的service，包括流程启动、终止以及根据流程实例/定义的一些查询方法</td>
   </tr>
   <tr>
      <td>2</td>
      <td>ITaskService</td>
      <td>任务相关service，包括查询待办、已办，等</td>
   </tr>
   <tr>
      <td>3</td>
      <td>IModelService</td>
      <td>直接根据模型进行的查询</td>
   </tr>
</table>

## 接口列表

### IInstanceService

    /**
	 * 启动流程 / 发起流程
	 * @param 流程发起参数对象:com.chamc.boot.bpm.model.process.param.StartBpmParam
	 */
	StartBpmResult startBpm(StartBpmParam param);

	/**
	 * 终止流程
	 * @param 用户id:userId
	 * @param 流程实例id:instanceId
	 * @param 评论:comment
	 * @return void
	 */
	void terminateBpm(String userId, String instanceId);
	void terminateBpm(String userId, String instanceId, String comment);
	
	/**
	 * 查询流转明细
	 * @param 流程实例ID:instanceId
	 */
	List<ProcessTransferDetail> queryTransferDetail(String instanceId);
	
	/**
	 * 查询流程变量
	 * @param 流程实例id:instanceId
	 * @return 变量列表:List<Variable>
	 */
	List<Variable> getProcessVariables(String instanceId);
	
	/**
	 * 根据processKey查询在运行中的流程
	 * @param 流程定义键值:processKey
	 * @return 流程实例列表:List<ProcessInstance>
	 */
	List<ProcessInstance> queryProcessInstance(String processKey);

**ITaskService**

注：page对象为分页对象，结果包含分页信息、排序信息及结果content；

	/**
	 * 查询待办
	 * @param userId:用户id
	 * @param processDefineKey:流程定义键值
	 * @param pageable:分页信息
	 * @param QueryTaskParam:查询参数对象，可以通过builder构造,有processTitle等属性
	 * @return Page<TaskTodo>:分页的TaskTodo
	 */
	Page<TaskTodo> queryTodo(String userId, Pageable pageable);
	Page<TaskTodo> queryTodo(String userId, String processDefineKey, Pageable pageable);
	Page<TaskTodo> queryTodo(QueryTaskParam param, Pageable pageable);
	
	/**
	 * 已过期，建议修改为<b>TaskTodo getTaskTodo(String taskId, String userId)</b>
	 */
	@Deprecated
	TaskTodo getTaskTodo(String taskId);
	/**
	 * 根据taskId查询单个任务详情
	 * @param taskId:任务id
	 * @param userId:用户id
	 * @return TaskTodo
	 */
	TaskTodo getTaskTodo(String taskId, String userId);
	
	/**
	 * 查询已办
	 * @param userId:用户id
	 * @param processDefineKey:流程定义键值
	 * @param pageable:分页信息
	 * @param QueryTaskParam:查询参数对象，可以通过builder构造,有processTitle等属性
	 * @return Page<TaskDone>:分页的TaskDone
	 */
	Page<TaskDone> queryDone(String userId, Pageable pageable);
	Page<TaskDone> queryDone(String userId, String processDefineKey, Pageable pageable);
	Page<TaskDone> queryDone(QueryTaskParam param, Pageable pagealbe);
	
	/**
	 * 已过期，建议修改为<b>TaskDone getTaskDone(String taskId, String userId)</b>
	 */
	@Deprecated
	TaskDone getTaskDone(String taskId);
	/**
	 * 根据taskId查询单个任务详情
	 * @param taskId:任务id
	 * @param userId:用户id
	 * @return TaskTodo
	 */
	TaskDone getTaskDone(String taskId, String userId);
	
	/**
	 * 待办计数（计数当前任务下各个processKey分别有多少条待办）
	 * @return TaskCount:有total和detail信息，即总共多少待办，各个processKey有多少条待办
	 */
	TaskCount countTask(String userId);
	
	/**
	 * 同意审批
	 * @param taskId:任务id
	 * @param userId:用户id
	 * @param variables:变量
	 * @param comment:评论
	 * @param nextOrgId:指定下一节点的机构（选择参与人为“下一节点指定机构+角色”时有用）
	 */
	void completeTask(String taskId, String userId);
	void completeTask(String taskId, String userId, List<Variable> variables);
	void completeTask(String taskId, String userId, String comment);
	void completeTask(String taskId, String userId, String comment, List<Variable> variables);
	void completeTask(String taskId, String userId, String nextOrgId, String comment, List<Variable> variables);
	
	/**
	 * 同意并指派
	 * @param nextParticipates：指派的下一节点的参与人用户id列表
	 */
	void completeAndAssign(String taskId, String userId, List<String> nextParticipates);
	void completeAndAssign(String taskId, String userId, String comment, List<String> nextParticipates);
	void completeAndAssign(String taskId, String userId, String comment, List<String> nextParticipates, List<Variable> variables);
	
	/**
	 * 已过期，建议修改为<b>void assSign(String taskId, String userId, List<String> toUserIds, String comment);</b>
	 */
	@Deprecated
	void addSign(String taskId, List<String> userIds);
	/**
	 * 已过期，建议修改为<b>void assSign(String taskId, String userId, List<String> toUserIds, String comment);</b>
	 */
	@Deprecated
	void addSign(String taskId, List<String> userIds, String comment);
	
	/**
	 * 加签
	 * @param targetUserIds:被加签用户的用户id
	 */
	void addSign(String taskId, String userId, List<String> targetUserIds, String comment);
	
	/**
	 * 退回到上一步
	 */
	void reject(String taskId, String userId);
	void reject(String taskId, String userId, List<Variable> variables);
	void reject(String taskId, String userId, String comment);
	void reject(String taskId, String userId, String comment, List<Variable> variables);

	/**
	 * 退回到指定节点
	 * @param activityId:目标节点的节点id
	 */
	void rejectToSpecified(String taskId, String userId, String activityId);
	void rejectToSpecified(String taskId, String userId, String activityId, List<Variable> variables);
	void rejectToSpecified(String taskId, String userId, String activityId, String comment);
	void rejectToSpecified(String taskId, String userId, String activityId, String comment, List<Variable> variables);
	
	/**
	 * 退回到制单节点
	 */
	void rejectToFirst(String taskId, String userId);
	void rejectToFirst(String taskId, String userId, List<Variable> variables);
	void rejectToFirst(String taskId, String userId, String comment);
	void rejectToFirst(String taskId, String userId, String comment, List<Variable> variables);
	
	/**
	 * 转办任务
	 * @param toUserId:转办任务的任务接受者用户id
	 */
	void delegate(String taskId, String userId, String toUserId);
	void delegate(String taskId, String userId, String toUserId, String comment);
	
	/**
	 * 取回任务
	 * @param taskId：已办的任务id
	 */
	void reBack(String taskId, String userId, String comment, List<Variable> variables);
	
	/**
	 * 查询下一节点参与人
	 * @return NextTaskInfo：有assignee和candidateUser属性，如果assignee有人则任务必定到该用户，否则任务为各个候选人有待办
	 */
	NextTaskInfo queryNextTaskInfo(String taskId, String userId, String nextOrgId, List<Variable> variables);
	
	/**
	 * 查询下一节点配置信息
	 * @return List<ActivityConfig>：与流程图中节点上的配置信息对应，包括基本属性、表单属性和会签属性
	 */
	List<ActivityConfig> queryNextTaskConfig(String taskId, String userId, String nextOrgId, List<Variable> variables);
	

**IModelService**

	/**
	 * 查询制单节点配置信息或者制单后的第一个节点的配置信息
	 * @param processKey：流程定义键值
	 * @param skipFirst：是否跳过制单节点
	 * @return
	 */
	List<ActivityConfig> getInitialActivity(String processKey, boolean skipFirst, List<Variable> variables);
	
	/**
	 * 查询特定节点的配置信息
	 * @param procDefId：流程定义唯一id，一般为{processKey:version:uniqueNumber}
	 * @param activityDefId:流程图中流程节点的id
	 * @return
	 */
	ActivityConfig getConfigById(String procDefId, String activityDefId);